# Documentation for E08

## Plan

- [ ] Update topology
	- [ ] Physical schematic
	- [ ] Logical schematic

- [ ] Update & add virtual machines
	- [ ] Configuration of new router
	- [ ] Loopback interfaces

- [ ] Configure OSPF on routers
	- [ ] Dynamic routing
	- [ ] Checking for routing table
	
- Connectivity tests

- Configure cybersecurity to OSPF


# Updating topology

## Physical topology
![](/documentation/E08/E08NetworkCharts-PhysicalTopologyDraft1.png)

## Logical topology
![](/documentation/E08/E08NetworkCharts-LogicalTopologyDraft1.png)



- [x] Update topology
	- [x] Physical schematic
	- [x] Logical schematic



# Update & add virtual machines
Subnet No. 1

10.08.83.244/30 (0100) Between Vyos router B and C


Subnet No. 2

10.08.83.248/30 (1000) Between Vyos router A and B



Renaming Vyos Router C, initial configuration:

```	
'configure
	set system host-name [name]
	commit
	save
	exit'

Requires a full reboot of the Vyos virtual machine to take affect.
'poweroff 
y'

Checking interfaces on Vyos Router C:
'show configuration'

comparing interfaces to the adapters on the virtual machine. Updating logical and physical topology. 


Adding ip-addresses to interfaces:

Since I dont have any VLANS within the two new subnets, I set the ip address directly on the interfaces and not adding the vif option. 

' set interfaces ethernet eth3 address 10.8.83.246/30
  set interfaces ethernet eth0 address 10.8.83.250/30 
  commit
  save '

```	

![](/documentation/E08/RouterCAddresses.png)

Eventually I check the addresses and add them to each interface eth0 and eth3. 

I chose to delete the previous established static routes that were cloned from the original router. Not sure if this was neccesary if we are adding dynamic routing, but I think they would nomatter be wrong. 

![](/documentation/E08/DeletingRoutes.png)


Finally I check the configuration of the new interfaces on Vyos Router A and B, and add them to the topologies. 

![](/documentation/E08/NewCablesRouterAB.png)

From this I start a test pinging between routers. 
- Ping between Router A and B is positive. 
- Ping between Router B and C is positive. 
- Ping between Router A and C is positive. 

![](/documentation/E08/InitialRouterPingTests.png)

Ping outside of each subnet however is not yet possible, as no gateways or routing has been set. 

- [ ] Update & add virtual machines
	- [x] Configuration of new router
	- [ ] Loopback interfaces


# Addressing loopback interfaces

Initially I am trying to understand where the loopback lo would belong within the OSI model. As seen below, the loopback interface is linked to a certain ip-address, so in that sense I assume its a part of 
the network layer 3. However doing some searches on the matter, I find answers also describing that there isnt a clean separation of the two TCP and IP-stacks.  Having these working on multiple elements of 
the network layer, the transportation layer and also the session layer. Furthermore, loopback processing might also be done in a separate device driver that for the OS looks like any other device, and possibly even be looked
at as a part of the physical layer? Several answers describe it in the way that the OSI model might be used for describing the protocols themselves, but when it comes to ths structure of the network code its harder to place it in a singular location of the model. 

## Describing the subnets to use
```
"parent" subnet:
10.08.83.252/30
```

Approaching this made me need to step back to have a look on previous made subnets and the lessons I have learned so far. We could say that the /30 or /32 does not refer to the size of the 
subnet, but rather the range within. Thinking like this makes more sense, but still does not explain the regular information we have about subnets so far. 
Quite clearly there is no room for a subnet- or broadcastaddress within. /32 would have a subnet-mask of 255.255.255.255, and would only contain one single host. 
From some research I find that these are used for specific purposes, as loopback interfaces or a "host route". 

On my Vyos Router A I can see that 127.0.0.1 is refered to as link/loopback:

![](/documentation/E08/routeripaddress.png)

Previously I am familiar with this address described as "localhost", or the machine itself. Doing a quick search also shows the description that
the loopback address refers to the fact that no data packet addressed to 127.0.0.1 should leave the computer/host, 
and sending it the packet gets "looped back" to on itself, so the sender becomes the recipient. 

For example, previously we used an extension on Vistual Studio Code to host a webserver locally, on 127.0.0.1 :5500.


RFC1122 refers to the address 127.0.0.1 as a internal host loopback address, and no other addresses of this form must appear outside the host. 
Routers that pick up traffic from the address are supposed to drop the packets immidiately. Whilst trying to focus on the framework of the assignment,
it is curious to consider the use/purpose/plan for the rest of the addresses within 127.0.0.1 to 127.255.255.255, where the whole block is reserved.

Continuing on the exercise I believe the subnet mentioned above can be divided. Since I need three of the total 4 addresses avaliable, Ill describe those. 


- 10.8.83.253/32 - Vyos Router A
- 10.8.83.254/32 - Vyos Router B
- 10.8.83.255/32 - Vyos Router C


![](/documentation/E08/RouterLoopbackAddresses.png)


# Configuring OSPF on the routers

Initially I delete the old static routes from router A and B. Previously I already deleted them on the cloned router C, when changing its configurations. 

I continue setting the router-id manually to the loopback interfaces I previously added, on all 3 devices and using the addresses referred to above:

![](/documentation/E08/settingrouterid.png)


At this point I needed to take a step back, trying to figure out which exact subnets to add as ospf to within each router. 
Initially I only added the two subnets each router was connected to - between themselves. Completely forgetting the other workstation-groups, switches and loopback interfaces. 
I then realized that is not going to be enough, as they wont magically transfer the ospf further out in the area.

**The commands used at this point was set protocols ospf area 0 network -subnet-address-**

For each router, I add the loopback interface I previously set to them. In addition to that I kept the two subnets I already added to each router. 
Lastly I added the subnets that router A and Router B was connected to, and that I had not yet added.

So Router A would be a main point, connected to the following:

![](/documentation/E08/VyosRouterAospf1.png)

at this point I was wondering about the "greetings" between adjacent devices. As depicted in the picture below, both router A and router B will be
 sending information about the subnet .240/30. Is this somehow going to affect any processes in the routing? 

![](/documentation/E08/Question1.png)

In other words, if only router A is sharing information about the subnet between router A and B, it will still be known in the network topology, or vice verca if only router B is sharing its information.
Furhtermore, I was thinking what if a router would be disconnected or having issues, would it be beneficial of that subnet then to have another "broadcaster"? Then again, if router A goes down, the subnet between router A and B have little to no function. 
The end question I guess would be if it is an issue that two routers are sharing the information, if it would get duplicated somehow. Yet to find an answer to this, as I decide to add all subnets connected to each router. 

![](/documentation/E08/RouterBOspf.png)
![](/documentation/E08/RouterCOspf.png)


## OSPF status & information checks

Logging into the routers via ssh to easier copy the information, as that would be searchable and easier to maintain than screenshots. 

:zap:
Router A


```
**********************
show ip ospf neighbor*
**********************
vyos@vyos-router-a:~$ show ip ospf neighbor 

Neighbor ID     Pri State           Dead Time Address         Interface            RXmtL RqstL DBsmL
10.8.83.255       1 Full/Backup       31.553s 10.8.83.250     eth2:10.8.83.249         0     0     0        NOTE: Router C
10.8.83.254       1 Full/Backup       34.809s 10.8.83.242     eth1:10.8.83.241         0     0     0		NOTE: Router B


*************************************
show ip route ospf and show ip route*
*************************************
vyos@vyos-router-a:~$ show ip route ospf 
Codes: K - kernel route, C - connected, S - static, R - RIP,                                                
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,                                                   
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,                                            
       F - PBR, f - OpenFabric,                                                                             
       > - selected route, * - FIB route                                                                    
                                                                                                            
O   10.8.83.0/28 [110/1000] is directly connected, eth0.25, 00:13:50                                        
O   10.8.83.240/30 [110/100] is directly connected, eth1, 00:13:58                                          
O>* 10.8.83.244/30 [110/200] via 10.8.83.242, eth1, 00:12:29                                                
O   10.8.83.248/30 [110/100] is directly connected, eth2, 00:14:03                                          
O   10.8.83.253/32 [110/0] is directly connected, lo, 00:14:02
O>* 10.8.83.254/32 [110/100] via 10.8.83.242, eth1, 00:12:58
O>* 10.8.83.255/32 [110/100] via 10.8.83.250, eth2, 00:13:02
O   192.168.39.0/26 [110/1000] is directly connected, eth0.5, 00:13:50
O   192.168.39.64/26 [110/1000] is directly connected, eth0.15, 00:13:50
O>* 192.168.39.128/26 [110/1100] via 10.8.83.242, eth1, 00:12:58

vyos@vyos-router-a:~$ show ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR, f - OpenFabric,
       > - selected route, * - FIB route

O   10.8.83.0/28 [110/1000] is directly connected, eth0.25, 00:14:09
C>* 10.8.83.0/28 is directly connected, eth0.25, 00:14:24
O   10.8.83.240/30 [110/100] is directly connected, eth1, 00:14:17
C>* 10.8.83.240/30 is directly connected, eth1, 00:14:17
O>* 10.8.83.244/30 [110/200] via 10.8.83.242, eth1, 00:12:48
O   10.8.83.248/30 [110/100] is directly connected, eth2, 00:14:22
C>* 10.8.83.248/30 is directly connected, eth2, 00:14:22
O   10.8.83.253/32 [110/0] is directly connected, lo, 00:14:21
C>* 10.8.83.253/32 is directly connected, lo, 00:14:27
O>* 10.8.83.254/32 [110/100] via 10.8.83.242, eth1, 00:13:17
O>* 10.8.83.255/32 [110/100] via 10.8.83.250, eth2, 00:13:21
O   192.168.39.0/26 [110/1000] is directly connected, eth0.5, 00:14:09
C>* 192.168.39.0/26 is directly connected, eth0.5, 00:14:24
O   192.168.39.64/26 [110/1000] is directly connected, eth0.15, 00:14:09
C>* 192.168.39.64/26 is directly connected, eth0.15, 00:14:24
O>* 192.168.39.128/26 [110/1100] via 10.8.83.242, eth1, 00:13:17


**********************
show ip ospf database*
**********************
vyos@vyos-router-a:~$ show ip ospf database 

       OSPF Router with ID (10.8.83.253)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
10.8.83.253     10.8.83.253      894 0x80000012 0xfc99 6
10.8.83.254     10.8.83.254      857 0x8000000b 0xa05f 4
10.8.83.255     10.8.83.255      857 0x80000007 0x2a0c 3

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
10.8.83.241     10.8.83.253      894 0x80000001 0x0bcf
10.8.83.246     10.8.83.255      857 0x80000001 0xe4ec
10.8.83.249     10.8.83.253      899 0x80000001 0xc809


```


:zap:
Router B


```
**********************
show ip ospf neighbor*
**********************
vyos@vyos-router-b:~$ show ip ospf neighbor 

Neighbor ID     Pri State           Dead Time Address         Interface            RXmtL RqstL DBsmL
10.8.83.255       1 Full/DR           37.196s 10.8.83.246     eth0:10.8.83.245         0     0     0
10.8.83.253       1 Full/DR           33.837s 10.8.83.241     eth1:10.8.83.242         0     0     0


*************************************
show ip route ospf and show ip route*
*************************************
yos@vyos-router-b:~$ show ip route ospf 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR, f - OpenFabric,
       > - selected route, * - FIB route

O>* 10.8.83.0/28 [110/1100] via 10.8.83.241, eth1, 00:17:00
O   10.8.83.240/30 [110/100] is directly connected, eth1, 00:17:10
O   10.8.83.244/30 [110/100] is directly connected, eth0, 00:16:31
O>* 10.8.83.248/30 [110/200] via 10.8.83.246, eth0, 00:16:31
  *                          via 10.8.83.241, eth1, 00:16:31
O>* 10.8.83.253/32 [110/100] via 10.8.83.241, eth1, 00:17:00
O   10.8.83.254/32 [110/0] is directly connected, lo, 00:17:16
O>* 10.8.83.255/32 [110/100] via 10.8.83.246, eth0, 00:16:31
O>* 192.168.39.0/26 [110/1100] via 10.8.83.241, eth1, 00:17:00
O>* 192.168.39.64/26 [110/1100] via 10.8.83.241, eth1, 00:17:00
O   192.168.39.128/26 [110/1000] is directly connected, eth2, 00:17:16

vyos@vyos-router-b:~$ show ip route 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR, f - OpenFabric,
       > - selected route, * - FIB route

O>* 10.8.83.0/28 [110/1100] via 10.8.83.241, eth1, 00:17:17
O   10.8.83.240/30 [110/100] is directly connected, eth1, 00:17:27
C>* 10.8.83.240/30 is directly connected, eth1, 00:17:30
O   10.8.83.244/30 [110/100] is directly connected, eth0, 00:16:48
C>* 10.8.83.244/30 is directly connected, eth0, 00:17:37
O>* 10.8.83.248/30 [110/200] via 10.8.83.246, eth0, 00:16:48
  *                          via 10.8.83.241, eth1, 00:16:48
O>* 10.8.83.253/32 [110/100] via 10.8.83.241, eth1, 00:17:17
O   10.8.83.254/32 [110/0] is directly connected, lo, 00:17:33
C>* 10.8.83.254/32 is directly connected, lo, 00:17:43
O>* 10.8.83.255/32 [110/100] via 10.8.83.246, eth0, 00:16:48
O>* 192.168.39.0/26 [110/1100] via 10.8.83.241, eth1, 00:17:17
O>* 192.168.39.64/26 [110/1100] via 10.8.83.241, eth1, 00:17:17
O   192.168.39.128/26 [110/1000] is directly connected, eth2, 00:17:33
C>* 192.168.39.128/26 is directly connected, eth2, 00:17:42


**********************
show ip ospf database*
**********************
vyos@vyos-router-b:~$ show ip ospf database 

       OSPF Router with ID (10.8.83.254)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
10.8.83.253     10.8.83.253     1068 0x80000012 0xfc99 6
10.8.83.254     10.8.83.254     1030 0x8000000b 0xa05f 4
10.8.83.255     10.8.83.255     1031 0x80000007 0x2a0c 3

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
10.8.83.241     10.8.83.253     1069 0x80000001 0x0bcf
10.8.83.246     10.8.83.255     1031 0x80000001 0xe4ec
10.8.83.249     10.8.83.253     1073 0x80000001 0xc809


```


:zap:
Router C


```
**********************
show ip ospf neighbor*
**********************
vyos@vyos-router-c:~$ show ip ospf neighbor 

Neighbor ID     Pri State           Dead Time Address         Interface            RXmtL RqstL DBsmL
10.8.83.254       1 Full/Backup       31.081s 10.8.83.245     eth3:10.8.83.246         0     0     0
10.8.83.253       1 Full/DR           32.572s 10.8.83.249     eth0:10.8.83.250         0     0     0


*************************************
show ip route ospf and show ip route*
*************************************
vyos@vyos-router-c:~$ show ip route ospf 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR, f - OpenFabric,
       > - selected route, * - FIB route

O>* 10.8.83.0/28 [110/1100] via 10.8.83.249, eth0, 00:18:48
O>* 10.8.83.240/30 [110/200] via 10.8.83.249, eth0, 00:18:48
O   10.8.83.244/30 [110/300] via 10.8.83.249, eth0, 00:18:39
O   10.8.83.248/30 [110/100] is directly connected, eth0, 00:18:53
O>* 10.8.83.253/32 [110/100] via 10.8.83.249, eth0, 00:18:48
O>* 10.8.83.254/32 [110/200] via 10.8.83.249, eth0, 00:18:39
O   10.8.83.255/32 [110/0] is directly connected, lo, 00:18:55
O>* 192.168.39.0/26 [110/1100] via 10.8.83.249, eth0, 00:18:48
O>* 192.168.39.64/26 [110/1100] via 10.8.83.249, eth0, 00:18:48
O>* 192.168.39.128/26 [110/1200] via 10.8.83.249, eth0, 00:18:39

vyos@vyos-router-c:~$ show ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR, f - OpenFabric,
       > - selected route, * - FIB route

O>* 10.8.83.0/28 [110/1100] via 10.8.83.249, eth0, 00:19:00
O>* 10.8.83.240/30 [110/200] via 10.8.83.249, eth0, 00:19:00
O   10.8.83.244/30 [110/300] via 10.8.83.249, eth0, 00:18:51
C>* 10.8.83.244/30 is directly connected, eth3, 00:19:13
O   10.8.83.248/30 [110/100] is directly connected, eth0, 00:19:05
C>* 10.8.83.248/30 is directly connected, eth0, 00:19:11
O>* 10.8.83.253/32 [110/100] via 10.8.83.249, eth0, 00:19:00
O>* 10.8.83.254/32 [110/200] via 10.8.83.249, eth0, 00:18:51
O   10.8.83.255/32 [110/0] is directly connected, lo, 00:19:07
C>* 10.8.83.255/32 is directly connected, lo, 00:19:15
O>* 192.168.39.0/26 [110/1100] via 10.8.83.249, eth0, 00:19:00
O>* 192.168.39.64/26 [110/1100] via 10.8.83.249, eth0, 00:19:00
O>* 192.168.39.128/26 [110/1200] via 10.8.83.249, eth0, 00:18:51


**********************
show ip ospf database*
**********************
vyos@vyos-router-c:~$ show ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, D - SHARP,
       F - PBR, f - OpenFabric,
       > - selected route, * - FIB route

O>* 10.8.83.0/28 [110/1100] via 10.8.83.249, eth0, 00:19:00
O>* 10.8.83.240/30 [110/200] via 10.8.83.249, eth0, 00:19:00
O   10.8.83.244/30 [110/300] via 10.8.83.249, eth0, 00:18:51
C>* 10.8.83.244/30 is directly connected, eth3, 00:19:13
O   10.8.83.248/30 [110/100] is directly connected, eth0, 00:19:05
C>* 10.8.83.248/30 is directly connected, eth0, 00:19:11
O>* 10.8.83.253/32 [110/100] via 10.8.83.249, eth0, 00:19:00
O>* 10.8.83.254/32 [110/200] via 10.8.83.249, eth0, 00:18:51
O   10.8.83.255/32 [110/0] is directly connected, lo, 00:19:07
C>* 10.8.83.255/32 is directly connected, lo, 00:19:15
O>* 192.168.39.0/26 [110/1100] via 10.8.83.249, eth0, 00:19:00
O>* 192.168.39.64/26 [110/1100] via 10.8.83.249, eth0, 00:19:00
O>* 192.168.39.128/26 [110/1200] via 10.8.83.249, eth0, 00:18:51


```



































Notes:
- Last week "switching loops" in OSI L2. Also a phenomenon called "routing loops" on L3. TTL-field in L3-packets helps preventing meltdowns.
- Static routing vs dynamic routing. Instead of creating routes, the router devices broadcast information and listen to information between eachother "adjacencies". 
- Large scale, distance vector. Distance/direction. Main protocol in this course is called Border Gateway Protocol.
- OSPF Open Shortest Path First. Calculating cost of each route by measuring/taking the metric(calculations) based on links between devices, cable quality, distance and such. 
Djikstra's algoritmn, which tell the shortest path from _one_ node to every other node. 

- Changing bandwidth reference must be done on all routers. This seems to be quite vital in particularily fast ethernets. By default the reference-bandwidth is 100 Mbits/sec. 
If you then have a 100 Mbits line, it has a cost of 1. Seeing then that you also have a line of 10 Gbit, the cost-value can not be lower than 1, hence it gets registred with the same cost. 
To take advantage of faster speeds, change the reference value. 

Adjacencies between routers are formed through exchange of OSPF -packets. 

Router-ID is the IPv4 address, set by the admin. This so the routers will know who is where/what. If this is not done/forgotten - default is that the highest binary value of the IPv4 addresses of loopback interfaces. 
Lastly if this is not avaliable, the highest IPv4 of other interfaces will be the ID. 


![](/documentation/E08/RouterRelationship_NetworkTypesOSPFv2.png)

![](/documentation/E08/OSPFNeighborshipStates.png)

- show ip route

C, physically connected, routes are better than dynamically learnt routes. 

- show ip ospf

instability? check SPF run times. If instability, it updates and runs many times. 
